<span *ngIf="loading" >
  <div [hidden]="!loading" class="loading">
    <img src="assets/loading.svg" alt="loading">
  </div>
</span>

<div class="main-panel home maintenance" [class.principal-externo]="acessoExterno" style="height: 100%;">
  <nav class="navbar navbar-summary navbar-expand-lg navbar-transparent navbar-fixed fixed-top">
    <div class="container-fluid justify-content-left">
      <div class="navbar-wrapper">
        <div style="margin-left:20px">
          <a class="navbar-brand">
            <h3 style=" margin-bottom: 0;">Produtividade</h3>
            <h6 style="font-weight: 300;"> HOME > PRODUTIVIDADE</h6>
          </a>
        </div>
      </div>
      <app-collapse-hamburguer-button></app-collapse-hamburguer-button>
    </div>
  </nav>
  <div class="property-summary summary-complete">
    <div class="general-info summary-content pt-3 charts" style="height: 100%;">
      <div class="chartsDiv light-group" style="display: flex;">
        <div class="row justify-content-between" style="width: 100%;">
          <div class="row" *ngIf="adminView">
            <app-history-navigation-inputed
              [resolution]="resolution" 
              [startDate]="startDate" 
              [endDate]="endDate" 
              (onViewChange)="onNavigationDateChange($event)">
            </app-history-navigation-inputed>

            <div class="filter-button">
              <button class="form-control" type="button" (click)="doFilter()">
                <span>Atualizar</span>
              </button>
            </div>
          </div>

          <div *ngIf="!adminView" class="row justify-content-between align-items-center" style="width: 80%;">
            <div class="col-sm-12">
              <div class="row justify-content-between align-items-center">
                <div class="row">
                  <div>
                    <h4>Filtros:</h4>
                  </div>
                  <app-filter class="filter-buttons mx-1" 
                    [items]="statusAdvanced" [caption]="'Status'" [selected]="null"
                    (selectedModified)="selecionarStatusDetail($event)">
                  </app-filter>
      
                  <app-filter class="filter-buttons mx-1" 
                    [items]="categoriesAdvanced" [caption]="'Categoria'" [selected]="null"
                    (selectedModified)="selecionarCategoriaDetail($event)">
                  </app-filter>

                  <app-filter class="filter-buttons mx-1" 
                    [items]="sectorsAdvanced" [caption]="(acessoExterno ? sector : 'Setor')" [selected]="null" [disabled]="acessoExterno"
                    (selectedModified)="selecionarSetorDetail($event)">
                  </app-filter>
      
                  <app-filter class="filter-buttons mx-1" 
                    [items]="wardsAdvanced" [caption]="'Ala'" [selected]="null"
                    (selectedModified)="selecionarAlaDetail($event)">
                  </app-filter>
      
                  <app-filter class="filter-buttons mx-1" 
                    [items]="subjectsAdvanced" [caption]="'Leito'" [selected]="null"
                    (selectedModified)="selecionarUnidadeDetail($event)">
                  </app-filter>

                  <app-filter class="filter-buttons mx-1" 
                    [items]="slaAdvanced" [caption]="'Sla'" [selected]="null"
                    (selectedModified)="selecionarSlaDetail($event)">
                  </app-filter>
                </div>
              </div>
              <div class="row margin-filter-bar">
                <div class="datas">
                  <app-history-navigation-inputed
                    [resolution]="resolution" 
                    [startDate]="rangeDates[0]" 
                    [endDate]="rangeDates[1]" 
                    [showFilter]="false"
                    (onViewChange)="setRangeDate($event)">
                  </app-history-navigation-inputed>
                </div>

                <div class="filter-button">
                  <button class="form-control" type="button" (click)="doFilter()">
                    <span>Atualizar</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="buttons-join">
            <button type="button" class="btn btn-sm mx-1 btn-outline-secondary" [class.activation]="adminView" (click)="initView('admin')">admin view</button>
            <button type="button" class="btn btn-sm mx-1 btn-outline-secondary" [class.activation]="!adminView" (click)="initView('detail')">detail view</button>
          </div>
        </div>
      </div>

      <div *ngIf="adminView" class="chartsDiv light-group" style="display: flex;">
        <div style="width: 60%;">
          <app-charts-component 
            class="charts-component-one" 
            [type]="CHART_TYPES.BAR_VERTICAL" 
            [title]="'Pedidos em aberto há mais de 30 minutos'"
            [itens]="halfHourData" 
            [exibirSeletor]="true" 
            [seletorWards]="seletorWards"
            [seletorSubjects]="seletorSubjects"
            (clickBarVerticalEvent)="halfChartClickEvent($event)"
            (selectedFilterEvent)="selectedFilterEvent($event)">
          </app-charts-component>
          <section style="margin-top:1rem"></section>
          <app-charts-component [type]="CHART_TYPES.BAR_VERTICAL" [title]="'Top 5 de áreas com pedidos fechados fora da SLA'" [itens]="afterSlaData" (clickBarVerticalEvent)="afterSlaChartClickEvent($event)"></app-charts-component>
          <section style="margin-top:1rem"></section>
        </div>
        <div style="width: 40%; padding-left: 2rem;">
          <app-charts-component [type]="CHART_TYPES.PIZZA" [title]="'Top 5 de áreas com pedidos em aberto'" [itens]="topFiveOppened" (clickPizzaEvent)="clickPizza($event)"></app-charts-component>
          <section style="margin-top:1rem"></section>
          
          <!-- TABLE -->
          <div class="light-group" style="height: 100%; max-height: 300px;">
            <div class="open-orders">
                <div class="chart-header">
                    <div>
                        <span style="font-size: 18px;font-weight: 600;">Top 5 de ALAS com mais pedidos em aberto</span>
                    </div>
                    <div class="subtitle-icon"></div>
                </div>
                <div style="width: 100%; box-sizing: border-box; padding: 10px;">
                  <proxper-grid class="proxper-grid" [showDataButton]="false" [customColumns]="cols" [data]="data"></proxper-grid>
                </div>
            </div>
          </div>
          <!-- END TABLE -->

          <section style="margin-top:1rem"></section>
        </div>
      </div>

      <div *ngIf="!adminView" class="chartsDiv light-group" style="display: flex;">
        <div style="width: 50%;">
          <app-charts-component [type]="CHART_TYPES.STACKED_LINE" [title]="'Pedidos por Situação x Tempo de Espera'" [itens]="opennedAdvance"></app-charts-component>
          <section style="margin-top:1rem"></section>
          <app-charts-component [type]="CHART_TYPES.BAR_HORIZONTAL" [title]="'Pedidos finalizados fora do SLA por Área'" [itens]="afterSlaAdvance"></app-charts-component>
          <section style="margin-top:1rem"></section>
        </div>
        <div style="width: 50%; padding-left: 2rem;">
          <app-charts-component [type]="CHART_TYPES.BAR_VERTICAL_SIMPLE" [title]="'Pedidos por Área'" [itens]="categoriesAdvance"></app-charts-component>
          <section style="margin-top:1rem"></section>
          <app-charts-component [type]="CHART_TYPES.BAR_VERTICAL_SIMPLE" [title]="'Pedidos por Ala'" [itens]="wardsAdvance"></app-charts-component>
          <section style="margin-top:1rem"></section>
        </div>
      </div>

      
      
      <div class="chartsDiv" *ngIf="false">
        <div (click)="openDiv[7] = !openDiv[7]">
          <span>8. Relatório completo de pedidos com filtros por setor, quarto, categoria, período e status.</span>
        </div>
      </div>
    </div>
  </div>
  <!-- grid -->
  <div *ngIf="!adminView">
    <app-collapse-grid [data]="gridData" (gridFiltroSelecionado)="gerarGridData($event)"></app-collapse-grid>
  </div>
</div>
